#!/bin/bash
export directory=$(dirname $(realpath /usr/local/bin/dg))
source $directory/_scripts/functions.sh

showHelp() {
    printf "${NC}$(basename "$0") [-h] [ d db dbl drb drbl r cms tf] -- program to manage dgrebb.com\n
    -h                      show this help text
    d | dev                 run strapi in development mode outside of docker
    db | dbuild             build docker images for aws
    dbl | dbuildlocal       build docker images to run locally
    drb | drebuild          rebuild docker images for aws
    drbl                    rebuild docker images to run locally
    dp                      push docker image
    r | run                 run local docker image
    cms                     interact with strapi sans docker
        dev                 run strapi in development mode
    tf                      run terraform commands
        i | init            initialize terraform
        iu | init-upgrade   upgrade terraform
        p | plan            plan terraform
        a | apply           apply terraform
    \n\n"
}

if [[ $1 != "v" ]]; then
    hello
fi

while test "$1" != --; do
    case $1 in
    c | cms)
        /bin/bash $directory/_scripts/cms.sh $2
        break
        ;;
    f | front)
        /bin/bash $directory/_scripts/front.sh $2 $3
        break
        ;;
    d | docker)
        /bin/bash $directory/_scripts/docker.sh $2 $3
        break
        ;;
    tf | terraform)
        /bin/bash $directory/_scripts/terraform.sh $2 $3 $4 $5 $6
        break
        ;;
    b | bump)
        /bin/bash $directory/_scripts/bump.sh
        break
        ;;
    g | github )
        open https://github.com/dgrebb/dgrebb.com
        break
        ;;
    gp | github-project )
        open https://github.com/users/dgrebb/projects/12
        break
        ;;
    a | act )
        /bin/bash $directory/_scripts/act.sh $2 $3
        break
        ;;
    tv | test-visual | backstop )
        /bin/bash $directory/_scripts/visual-regression.sh
        break
        ;;
    tvr | test-visual-ref | backstop-reference )
        /bin/bash $directory/_scripts/visual-regression.sh ref
        break
        ;;
    -h | --help)
        showHelp
        break
        ;;
    --)
        showHelp
        break
        ;;
    *)
        projectPath=$(realpath ${directory}/..)
        if [ $(pwd) = ${projectPath} ]; then
            printDgErr "Unexpected args â€” you done goofed!" ]
            showHelp
        else
            printDgMsg "Moving to project directory"
            cd ${directory}/../
            $SHELL
        fi
        break
        ;;
    esac
done
err=$?
[[ $err != 0 ]] && exit $err
